using BigNumberRecursiveMod;
using System.Diagnostics;
using System.Numerics;

namespace TestRecursiveMod;

public class RecursiveModTest
{
    [Fact]
    public void T01()
    {
        string numberSequence = "777635";
        string divder = "32";

        int mod = RecursiveMod.CalculateMod(numberSequence, divder);

        Assert.Equal(3, mod);
    }

    [Fact]
    public void T02()
    {
        string numberSequence = "999999";
        string divder = "68";

        int mod = RecursiveMod.CalculateMod(numberSequence, divder);

        Assert.Equal(59, mod);
    }

    [Fact]
    public void T03()
    {
        string numberSequence = "491984984";
        string divder = "978";

        int mod = RecursiveMod.CalculateMod(numberSequence, divder);

        Assert.Equal(128, mod);
    }

    [Fact]
    public void T04()
    {
        string numberSequence = "41646849849849161654198498498498498498498498465416515151564651189198484000084984987496874984984984894984984984984981";
        string divder = "97";

        int mod = RecursiveMod.CalculateMod(numberSequence, divder);

        Assert.True(mod < 97);
    }

    [Fact]
    public void T05()
    {
        string numberSequence = "416468498498491616848848498498484498498498498798798798798984798987782978927982978297892792978629678296782968962789629678296782967896279682967829679862967829678296789627968296782967829678962798629782967829678962798629678296789267892976829592952975297529752975962795629675967967952795279529752975297592795292975297592795297529752967592679562795629765296752967596279465297465296745926745962745962967452967459267459627946529674529674956279456297645296745296745962754962795462967542967452967459627459627965429675429674529675492674965297645296752967596427496529765429674529674596279465296752967926796527965296752967549627965297654296754296745962749562976452967452967452967459267496529764529674529674596274956279465296745296745962794652976452967592679564297654296754296745962794562976452967452967459627954629764529674529674956274956296745296745926754962794652967452968464684684687878787979798765465119819848949849847846846486768768768768768768768748687467486874687467846784786487668768786711188618616816816886486468468746876876874684684684681681681684684687687684681684684687687487978979875646818191984968476874357464981984685476874687468576847816846846874689749867498674897844468486684846468468648648797852978529782579825785978925789527895279827985259789257859278952798527982978957825978592789527985279852798529578529785927895278952798275928268468464684681684684968495256295628756287568276528476528745628475624875624875624875624875624875624875628475624875624875628475628475628745628746578246578245687246752468752467856782456872465782468752467852684756782458672456872468752468752467856782456872456782468752486756278456782456872467852467852768458762456782467852467852467856872456782456782467852467856782452458924579824798529478587924587924879524789529874578924578924897524879528794587924578924987524879528479587924589724589724879527894587294578924587929874528794568498496849684684649649684984961968196849684984984968496846984698496496879879879847698468468468468468468746874684684684684768468746874684684684684647684687468768746874684684684653454648468468468468468468468468468468468787878787878555554198498498498498498498498465416515151564651189198484000084984987496874984984984894984984984984981";

        
        BigInteger dividerBitInt = 97;

        Stopwatch sw = new();

        GC.Collect(); // clean up before measurement
        GC.WaitForPendingFinalizers();
        GC.Collect();

        long before1 = GC.GetTotalMemory(true);
        sw.Start();
        var numSeqBigInt = BigInteger.Parse(numberSequence);
        var mod1 = (int)(numSeqBigInt % dividerBitInt);
        sw.Stop();
        var time1 = sw.Elapsed;
        long after1 = GC.GetTotalMemory(true);
        long total1 = after1 - before1;

        GC.Collect(); // clean up before measurement
        GC.WaitForPendingFinalizers();

        long before2 = GC.GetTotalMemory(true);
        sw.Start();
        int mod2 = RecursiveMod.CalculateMod(numberSequence, 97);
        sw.Stop();
        var time2 = sw.Elapsed;
        long after2 = GC.GetTotalMemory(true);
        long total2 = after2 - before2;

        //long before3 = GC.GetTotalMemory(true);
        //sw.Start();
        //int mod3 = RecursiveMod.CalculateRecursiveOld(numberSequence, 97, 2);
        //sw.Stop();
        //var time3 = sw.Elapsed;
        //long after3 = GC.GetTotalMemory(true);
        //long total3 = after3 - before3;

        Assert.Equal(mod1, mod2);
    }
}